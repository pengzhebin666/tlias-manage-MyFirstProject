<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.mapper.ClazzMapper">
    <!-- 在 ClazzMapper.xml 中检查SQL语句 -->

    <select id="list" resultType="com.itheima.pojo.Clazz">
        select
        c.id AS id,
        c.name AS name,
        c.room AS room,
        c.begin_date AS beginDate,
        c.end_date AS endDate,
        c.master_id AS masterId,
        c.create_time AS createTime,
        c.update_time AS updateTime,
        COALESCE(e.name, '无班主任') AS masterName,  -- 空值优化：无班主任时显示"无班主任"
        (case when now() &lt; c.begin_date THEN '未开班'
        when now() &gt; c.end_date THEN '已结课'
        ELSE '已开班'
        end) as status
        from clazz c left join emp e
        on c.master_id = e.id
        <where>
            <!-- 添加动态条件 -->
            <if test="name != null and name != ''">
                AND c.name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="room != null and room != ''">
                AND c.room = #{room}
            </if>
            <if test="begin != null">
                AND c.begin_date &gt;= #{begin}
            </if>
            <if test="end != null">
                AND c.end_date &lt;= #{end}
            </if>
            <if test="masterId != null">
                AND c.master_id = #{masterId}
            </if>
            <if test="status != null and status != ''">
                AND (
                (#{status} = '未开班' AND NOW() &lt; c.begin_date) OR
                (#{status} = '已结课' AND NOW() &gt; c.end_date) OR
                (#{status} = '已开班' AND NOW() &gt;= c.begin_date AND NOW() &lt;= c.end_date)
                )
            </if>
        </where>
        ORDER BY c.id DESC
    </select>
    <select id="getById" resultType="com.itheima.pojo.Clazz">
        SELECT
        c.*,
        e.name AS master_name
        FROM clazz c
        LEFT JOIN emp e ON c.master_id = e.id
        WHERE c.id = #{id}
    </select>


</mapper>